{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import{Platform}from'@unimodules/core';import{getAssetByID}from\"./AssetRegistry\";import*as AssetSources from\"./AssetSources\";import*as AssetUris from\"./AssetUris\";import{getEmbeddedAssetUri}from\"./EmbeddedAssets\";import*as ImageAssets from\"./ImageAssets\";import{downloadAsync as _downloadAsync,IS_MANAGED_ENV}from\"./PlatformUtils\";import resolveAssetSource from\"./resolveAssetSource\";export var Asset=function(){function Asset(_ref){var name=_ref.name,type=_ref.type,_ref$hash=_ref.hash,hash=_ref$hash===void 0?null:_ref$hash,uri=_ref.uri,width=_ref.width,height=_ref.height;_classCallCheck(this,Asset);this.hash=null;this.localUri=null;this.width=null;this.height=null;this.downloading=false;this.downloaded=false;this._downloadCallbacks=[];this.name=name;this.type=type;this.hash=hash;this.uri=uri;if(typeof width==='number'){this.width=width;}if(typeof height==='number'){this.height=height;}if(IS_MANAGED_ENV&&hash){this.localUri=getEmbeddedAssetUri(hash,type);if(this.localUri){this.downloaded=true;}}if(Platform.OS==='web'){if(!name){this.name=AssetUris.getFilename(uri);}if(!type){this.type=AssetUris.getFileExtension(uri);}}}_createClass(Asset,[{key:\"downloadAsync\",value:function downloadAsync(){var _this=this;var _ref2,width,height,name;return _regeneratorRuntime.async(function downloadAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!this.downloaded){_context.next=2;break;}return _context.abrupt(\"return\");case 2:if(!this.downloading){_context.next=6;break;}_context.next=5;return _regeneratorRuntime.awrap(new Promise(function(resolve,reject){_this._downloadCallbacks.push({resolve:resolve,reject:reject});}));case 5:return _context.abrupt(\"return\");case 6:this.downloading=true;_context.prev=7;if(!(Platform.OS==='web')){_context.next=22;break;}if(!ImageAssets.isImageType(this.type)){_context.next=21;break;}_context.next=12;return _regeneratorRuntime.awrap(ImageAssets.getImageInfoAsync(this.uri));case 12:_ref2=_context.sent;width=_ref2.width;height=_ref2.height;name=_ref2.name;this.width=width;this.height=height;this.name=name;_context.next=22;break;case 21:this.name=AssetUris.getFilename(this.uri);case 22:_context.next=24;return _regeneratorRuntime.awrap(_downloadAsync(this.uri,this.hash,this.type,this.name));case 24:this.localUri=_context.sent;this.downloaded=true;this._downloadCallbacks.forEach(function(_ref3){var resolve=_ref3.resolve;return resolve();});_context.next=33;break;case 29:_context.prev=29;_context.t0=_context[\"catch\"](7);this._downloadCallbacks.forEach(function(_ref4){var reject=_ref4.reject;return reject(_context.t0);});throw _context.t0;case 33:_context.prev=33;this.downloading=false;this._downloadCallbacks=[];return _context.finish(33);case 37:case\"end\":return _context.stop();}}},null,this,[[7,29,33,37]]);}}],[{key:\"loadAsync\",value:function loadAsync(moduleId){var moduleIds=Array.isArray(moduleId)?moduleId:[moduleId];return Promise.all(moduleIds.map(function(moduleId){return Asset.fromModule(moduleId).downloadAsync();}));}},{key:\"fromModule\",value:function fromModule(virtualAssetModule){if(typeof virtualAssetModule==='string'){return Asset.fromURI(virtualAssetModule);}var meta=getAssetByID(virtualAssetModule);if(!meta){throw new Error(\"Module \\\"\"+virtualAssetModule+\"\\\" is missing from the asset registry\");}if(!IS_MANAGED_ENV){var _resolveAssetSource=resolveAssetSource(virtualAssetModule),uri=_resolveAssetSource.uri;var asset=new Asset({name:meta.name,type:meta.type,hash:meta.hash,uri:uri,width:meta.width,height:meta.height});if(Platform.OS==='android'&&!uri.includes(':')&&(meta.width||meta.height)){asset.localUri=asset.uri;asset.downloaded=true;}Asset.byHash[meta.hash]=asset;return asset;}return Asset.fromMetadata(meta);}},{key:\"fromMetadata\",value:function fromMetadata(meta){var metaHash=meta.hash;if(Asset.byHash[metaHash]){return Asset.byHash[metaHash];}else if(!IS_MANAGED_ENV&&!Asset.byHash[metaHash]){throw new Error('Assets must be initialized with Asset.fromModule');}var _AssetSources$selectA=AssetSources.selectAssetSource(meta),uri=_AssetSources$selectA.uri,hash=_AssetSources$selectA.hash;var asset=new Asset({name:meta.name,type:meta.type,hash:hash,uri:uri,width:meta.width,height:meta.height});Asset.byHash[metaHash]=asset;return asset;}},{key:\"fromURI\",value:function fromURI(uri){if(Asset.byUri[uri]){return Asset.byUri[uri];}var type='';if(uri.indexOf(';base64')>-1){type=uri.split(';')[0].split('/')[1];}else{var extension=AssetUris.getFileExtension(uri);type=extension.startsWith('.')?extension.substring(1):extension;}var asset=new Asset({name:'',type:type,hash:null,uri:uri});Asset.byUri[uri]=asset;return asset;}}]);return Asset;}();Asset.byHash={};Asset.byUri={};","map":{"version":3,"sources":["/home/rick/dev/cool-home/node_modules/expo-asset/build/Asset.js"],"names":["Platform","getAssetByID","AssetSources","AssetUris","getEmbeddedAssetUri","ImageAssets","downloadAsync","IS_MANAGED_ENV","resolveAssetSource","Asset","name","type","hash","uri","width","height","localUri","downloading","downloaded","_downloadCallbacks","OS","getFilename","getFileExtension","Promise","resolve","reject","push","isImageType","getImageInfoAsync","forEach","moduleId","moduleIds","Array","isArray","all","map","fromModule","virtualAssetModule","fromURI","meta","Error","asset","includes","byHash","fromMetadata","metaHash","selectAssetSource","byUri","indexOf","split","extension","startsWith","substring"],"mappings":"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","sourcesContent":["import { Platform } from '@unimodules/core';\nimport { getAssetByID } from './AssetRegistry';\nimport * as AssetSources from './AssetSources';\nimport * as AssetUris from './AssetUris';\nimport { getEmbeddedAssetUri } from './EmbeddedAssets';\nimport * as ImageAssets from './ImageAssets';\nimport { downloadAsync, IS_MANAGED_ENV } from './PlatformUtils';\nimport resolveAssetSource from './resolveAssetSource';\nexport class Asset {\n    constructor({ name, type, hash = null, uri, width, height }) {\n        this.hash = null;\n        this.localUri = null;\n        this.width = null;\n        this.height = null;\n        this.downloading = false;\n        this.downloaded = false;\n        this._downloadCallbacks = [];\n        this.name = name;\n        this.type = type;\n        this.hash = hash;\n        this.uri = uri;\n        if (typeof width === 'number') {\n            this.width = width;\n        }\n        if (typeof height === 'number') {\n            this.height = height;\n        }\n        // This only applies to assets that are bundled in Expo standalone apps\n        if (IS_MANAGED_ENV && hash) {\n            this.localUri = getEmbeddedAssetUri(hash, type);\n            if (this.localUri) {\n                this.downloaded = true;\n            }\n        }\n        if (Platform.OS === 'web') {\n            if (!name) {\n                this.name = AssetUris.getFilename(uri);\n            }\n            if (!type) {\n                this.type = AssetUris.getFileExtension(uri);\n            }\n        }\n    }\n    static loadAsync(moduleId) {\n        const moduleIds = Array.isArray(moduleId) ? moduleId : [moduleId];\n        return Promise.all(moduleIds.map(moduleId => Asset.fromModule(moduleId).downloadAsync()));\n    }\n    static fromModule(virtualAssetModule) {\n        if (typeof virtualAssetModule === 'string') {\n            return Asset.fromURI(virtualAssetModule);\n        }\n        const meta = getAssetByID(virtualAssetModule);\n        if (!meta) {\n            throw new Error(`Module \"${virtualAssetModule}\" is missing from the asset registry`);\n        }\n        // Outside of the managed env we need the moduleId to initialize the asset\n        // because resolveAssetSource depends on it\n        if (!IS_MANAGED_ENV) {\n            const { uri } = resolveAssetSource(virtualAssetModule);\n            const asset = new Asset({\n                name: meta.name,\n                type: meta.type,\n                hash: meta.hash,\n                uri,\n                width: meta.width,\n                height: meta.height,\n            });\n            // TODO: FileSystem should probably support 'downloading' from drawable\n            // resources But for now it doesn't (it only supports raw resources) and\n            // React Native's Image works fine with drawable resource names for\n            // images.\n            if (Platform.OS === 'android' && !uri.includes(':') && (meta.width || meta.height)) {\n                asset.localUri = asset.uri;\n                asset.downloaded = true;\n            }\n            Asset.byHash[meta.hash] = asset;\n            return asset;\n        }\n        return Asset.fromMetadata(meta);\n    }\n    static fromMetadata(meta) {\n        // The hash of the whole asset, not to be confused with the hash of a specific file returned\n        // from `selectAssetSource`\n        const metaHash = meta.hash;\n        if (Asset.byHash[metaHash]) {\n            return Asset.byHash[metaHash];\n        }\n        else if (!IS_MANAGED_ENV && !Asset.byHash[metaHash]) {\n            throw new Error('Assets must be initialized with Asset.fromModule');\n        }\n        const { uri, hash } = AssetSources.selectAssetSource(meta);\n        const asset = new Asset({\n            name: meta.name,\n            type: meta.type,\n            hash,\n            uri,\n            width: meta.width,\n            height: meta.height,\n        });\n        Asset.byHash[metaHash] = asset;\n        return asset;\n    }\n    static fromURI(uri) {\n        if (Asset.byUri[uri]) {\n            return Asset.byUri[uri];\n        }\n        // Possibly a Base64-encoded URI\n        let type = '';\n        if (uri.indexOf(';base64') > -1) {\n            type = uri.split(';')[0].split('/')[1];\n        }\n        else {\n            const extension = AssetUris.getFileExtension(uri);\n            type = extension.startsWith('.') ? extension.substring(1) : extension;\n        }\n        const asset = new Asset({\n            name: '',\n            type,\n            hash: null,\n            uri,\n        });\n        Asset.byUri[uri] = asset;\n        return asset;\n    }\n    async downloadAsync() {\n        if (this.downloaded) {\n            return;\n        }\n        if (this.downloading) {\n            await new Promise((resolve, reject) => {\n                this._downloadCallbacks.push({ resolve, reject });\n            });\n            return;\n        }\n        this.downloading = true;\n        try {\n            if (Platform.OS === 'web') {\n                if (ImageAssets.isImageType(this.type)) {\n                    const { width, height, name } = await ImageAssets.getImageInfoAsync(this.uri);\n                    this.width = width;\n                    this.height = height;\n                    this.name = name;\n                }\n                else {\n                    this.name = AssetUris.getFilename(this.uri);\n                }\n            }\n            this.localUri = await downloadAsync(this.uri, this.hash, this.type, this.name);\n            this.downloaded = true;\n            this._downloadCallbacks.forEach(({ resolve }) => resolve());\n        }\n        catch (e) {\n            this._downloadCallbacks.forEach(({ reject }) => reject(e));\n            throw e;\n        }\n        finally {\n            this.downloading = false;\n            this._downloadCallbacks = [];\n        }\n    }\n}\nAsset.byHash = {};\nAsset.byUri = {};\n//# sourceMappingURL=Asset.js.map"]},"metadata":{},"sourceType":"module"}